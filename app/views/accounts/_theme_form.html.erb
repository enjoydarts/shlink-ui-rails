<!-- テーマ設定フォーム -->
<%= form_with model: @user, url: account_path, method: :patch, local: true,
              data: { controller: "theme-selector", action: "ajax:success->theme-selector#handleSuccess" },
              html: { class: "space-y-6" } do |form| %>

  <!-- 現在の設定表示 -->
  <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl border border-purple-200 dark:border-purple-700/30 p-4">
    <div class="flex items-center">
      <div class="w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center mr-3">
        <svg width="16" height="16" viewBox="0 0 24 24" class="text-purple-600">
          <path fill="currentColor" d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.58,20 4,16.42 4,12C4,7.58 7.58,4 12,4C16.42,4 20,7.58 20,12C20,16.42 16.42,20 12,20M12,6C8.69,6 6,8.69 6,12C6,15.31 8.69,18 12,18C15.31,18 18,15.31 18,12C18,8.69 15.31,6 12,6Z"/>
        </svg>
      </div>
      <div>
        <p class="text-sm font-medium text-purple-800 dark:text-purple-200">現在の設定</p>
        <p class="text-lg font-semibold text-purple-900 dark:text-purple-100"><%= @user.theme_display_name %></p>
      </div>
    </div>
  </div>

  <!-- テーマ選択オプション -->
  <div class="space-y-4">
    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">テーマを選択</label>

    <div class="grid grid-cols-1 gap-4">
      <% User.theme_options.each do |display_name, value| %>
        <div class="relative">
          <%= form.radio_button :theme_preference, value,
                                class: "sr-only peer",
                                id: "theme_#{value}",
                                data: { action: "change->theme-selector#previewTheme" } %>
          <label for="theme_<%= value %>"
                 class="flex items-center p-4 border border-gray-200 dark:border-gray-600 rounded-xl cursor-pointer
                        hover:bg-gray-50 dark:hover:bg-gray-700/50 peer-checked:bg-purple-50 dark:peer-checked:bg-purple-900/30 peer-checked:border-purple-300
                        peer-checked:ring-2 peer-checked:ring-purple-200 dark:peer-checked:ring-purple-600/50 transition-all duration-200">

            <div class="flex items-center space-x-4 flex-1">
              <!-- テーマアイコン -->
              <% if value == "light" %>
                <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg flex items-center justify-center">
                  <svg width="20" height="20" viewBox="0 0 24 24" class="text-yellow-600">
                    <path fill="currentColor" d="M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
                  </svg>
                </div>
              <% elsif value == "dark" %>
                <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                  <svg width="20" height="20" viewBox="0 0 24 24" class="text-gray-600 dark:text-gray-300">
                    <path fill="currentColor" d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.4 6.35,17.41C9.37,20.43 14,20.54 17.33,17.97Z"/>
                  </svg>
                </div>
              <% else %>
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                  <svg width="20" height="20" viewBox="0 0 24 24" class="text-blue-600">
                    <path fill="currentColor" d="M4,6H20V16H4M20,18A2,2 0 0,0 22,16V6C22,4.89 21.1,4 20,4H4C2.89,4 2,4.89 2,6V16A2,2 0 0,0 4,18H0V20H24V18H20Z"/>
                  </svg>
                </div>
              <% end %>

              <!-- テーマ情報 -->
              <div class="flex-1">
                <div class="font-semibold text-gray-900 dark:text-gray-100"><%= display_name %></div>
                <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                  <% if value == "light" %>
                    明るい配色でアプリケーションを表示します
                  <% elsif value == "dark" %>
                    暗い配色でアプリケーションを表示します
                  <% else %>
                    お使いのデバイスの設定に従って自動で切り替わります
                  <% end %>
                </div>
              </div>

              <!-- 選択インジケーター -->
              <div class="flex-shrink-0">
                <div class="w-5 h-5 border-2 border-gray-300 dark:border-gray-600 rounded-full peer-checked:border-purple-600 peer-checked:bg-purple-600 relative">
                  <div class="absolute inset-0.5 bg-white dark:bg-gray-800 rounded-full peer-checked:bg-purple-600"></div>
                </div>
              </div>
            </div>
          </label>
        </div>
      <% end %>
    </div>
  </div>

  <!-- プレビューエリア -->
  <div data-theme-selector-target="preview" class="hidden p-4 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600">
    <div class="text-center">
      <p class="text-sm text-gray-600 dark:text-gray-400">テーマプレビュー</p>
      <div class="mt-2 p-3 rounded-lg" data-theme-selector-target="previewArea">
        <p class="font-medium">サンプルテキスト</p>
        <p class="text-sm opacity-75">このテーマではこのように表示されます</p>
      </div>
    </div>
  </div>

  <!-- 保存ボタン -->
  <div class="flex justify-end">
    <%= form.submit "テーマを保存",
                    class: "bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold
                           hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500
                           focus:ring-offset-2 transition-colors duration-200",
                    data: { disable_with: "保存中..." } %>
  </div>

<% end %>